# PanguPay æµè§ˆå™¨é’±åŒ…æ‰©å±• - å®Œæ•´è§£å†³æ–¹æ¡ˆ

> **é¡¹ç›®åç§°**ï¼šPanguPayExtension  
> **åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-21  
> **é¡¹ç›®å®šä½**ï¼šç›˜å¤ç³»ç»Ÿè½»é‡çº§æµè§ˆå™¨é’±åŒ…æ’ä»¶

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯)
2. [éœ€æ±‚åˆ†æ](#2-éœ€æ±‚åˆ†æ)
3. [æŠ€æœ¯è°ƒç ”æ€»ç»“](#3-æŠ€æœ¯è°ƒç ”æ€»ç»“)
4. [æ¶æ„è®¾è®¡](#4-æ¶æ„è®¾è®¡)
5. [åŠŸèƒ½æ¨¡å—è¯¦è§£](#5-åŠŸèƒ½æ¨¡å—è¯¦è§£)
6. [ä»£ç å¤ç”¨è®¡åˆ’](#6-ä»£ç å¤ç”¨è®¡åˆ’)
7. [ç›®å½•ç»“æ„](#7-ç›®å½•ç»“æ„)
8. [å¼€å‘è·¯çº¿å›¾](#8-å¼€å‘è·¯çº¿å›¾)
9. [æŠ€æœ¯å®ç°ç»†èŠ‚](#9-æŠ€æœ¯å®ç°ç»†èŠ‚)
10. [ç½‘ç«™å¯¹æ¥æŒ‡å—](#10-ç½‘ç«™å¯¹æ¥æŒ‡å—)

---

## 1. é¡¹ç›®èƒŒæ™¯

### 1.1 ç°æœ‰é¡¹ç›®

ç›˜å¤ç³»ç»Ÿç›®å‰åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼š

| é¡¹ç›® | è·¯å¾„ | è¯´æ˜ |
|:-----|:-----|:-----|
| **å‰ç«¯é’±åŒ…** | `TransferAreaInterface/` | å®Œæ•´ Web é’±åŒ…åº”ç”¨ï¼ŒHTML+CSS+TypeScript |
| **åç«¯èŠ‚ç‚¹** | `UTXO-Area/` | Go è¯­è¨€åŒºå—é“¾èŠ‚ç‚¹ç³»ç»Ÿ |

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æµè§ˆå™¨æ‰©å±•ï¼Ÿ

å‚è€ƒ MetaMaskã€Rabby ç­‰ä¸»æµé’±åŒ…ï¼š
- ç”¨æˆ·æ— éœ€æ‰“å¼€ç‹¬ç«‹ç½‘é¡µï¼Œç‚¹å‡»æµè§ˆå™¨å›¾æ ‡å³å¯ä½¿ç”¨
- ç¬¬ä¸‰æ–¹ DApp å¯ä»¥ç›´æ¥è°ƒç”¨æ‰©å±•è¿›è¡Œäº¤æ˜“
- æ›´ä¾¿æ·çš„ç”¨æˆ·ä½“éªŒï¼Œæ›´å¹¿æ³›çš„ç”Ÿæ€å¯¹æ¥èƒ½åŠ›

### 1.3 è®¾è®¡åŸåˆ™

- **ç®€æ´ä¼˜å…ˆ**ï¼šåªä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œç•Œé¢ç®€æ´ç¾è§‚
- **ä»£ç å¤ç”¨**ï¼šæœ€å¤§åŒ–å¤ç”¨ç°æœ‰å‰ç«¯é¡¹ç›®çš„æ ¸å¿ƒé€»è¾‘
- **æŠ€æœ¯ä¸€è‡´**ï¼šæ²¿ç”¨åŸç”Ÿ HTML+CSS+TypeScriptï¼Œä¸å¼•å…¥æ–°æ¡†æ¶

---

## 2. éœ€æ±‚åˆ†æ

### 2.1 æ ¸å¿ƒåŠŸèƒ½æ¸…å•

| åºå· | åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|:----:|:-----|:-----|:------:|
| 1 | **ç™»å½•ä¸æ³¨å†Œ** | åˆ›å»ºæ–°è´¦æˆ·ã€å¯¼å…¥ç§é’¥ã€å¯†ç ä¿æŠ¤ | P0 |
| 2 | **é’±åŒ…ä¿¡æ¯æŸ¥çœ‹** | æ˜¾ç¤ºä½™é¢ã€åœ°å€åˆ—è¡¨ã€å¤šå¸ç§èµ„äº§ | P0 |
| 3 | **å¿«é€Ÿè½¬è´¦** | ç»„ç»‡å†…å³æ—¶ç¡®è®¤è½¬è´¦ (TXCer) | P0 |
| 4 | **è·¨é“¾äº¤æ˜“** | BTC/ETH èµ„äº§æ¡¥æ¥è½¬è´¦ | P1 |
| 5 | **æ™®é€šè½¬è´¦** | æ— ç»„ç»‡æ•£æˆ·èšåˆäº¤æ˜“ | P1 |
| 6 | **æ‹…ä¿ç»„ç»‡ç®¡ç†** | åŠ å…¥/é€€å‡ºæ‹…ä¿ç»„ç»‡ | P1 |
| 7 | **äº¤æ˜“å†å²** | æŸ¥çœ‹å†å²äº¤æ˜“è®°å½• | P0 |

### 2.2 åŠŸèƒ½å¯¹æ¯”ï¼ˆWeb é’±åŒ… vs æ‰©å±•ï¼‰

| åŠŸèƒ½ | Web é’±åŒ… | æ‰©å±•æ’ä»¶ |
|:-----|:--------:|:--------:|
| å®Œæ•´èµ„äº§ç®¡ç† | âœ… | âœ… ç®€åŒ–ç‰ˆ |
| å¤šåœ°å€ç®¡ç† | âœ… å®Œæ•´ | âš ï¸ ç²¾ç®€ |
| äº¤æ˜“æ„é€  | âœ… | âœ… |
| å›¾è¡¨æŠ¥è¡¨ | âœ… | âŒ ä¸éœ€è¦ |
| DApp è¿æ¥ | âŒ | âœ… æ ¸å¿ƒç‰¹æ€§ |
| ç»„ç»‡é¢æ¿ | âœ… è¯¦ç»† | âš ï¸ ç®€åŒ– |

---

## 3. æŠ€æœ¯è°ƒç ”æ€»ç»“

### 3.1 Chrome æ‰©å±•æ¶æ„ (Manifest V3)

```
æ‰©å±•ç»„æˆï¼ˆæºä»£ç ï¼‰ï¼š
â”œâ”€â”€ manifest.json           # é…ç½®æ–‡ä»¶ï¼ˆæƒé™ã€å…¥å£ï¼‰
â”œâ”€â”€ src/background/index.ts # Service Worker å…¥å£ï¼ˆæ„å»ºåè¾“å‡ºï¼‰
â”œâ”€â”€ src/content/index.ts    # Content Script å…¥å£ï¼ˆæ„å»ºåè¾“å‡ºï¼‰
â”œâ”€â”€ src/content/inject.ts   # æ³¨å…¥ç½‘é¡µè„šæœ¬ï¼ˆweb_accessible_resourcesï¼‰
â”œâ”€â”€ src/popup/              # å¼¹çª—é¡µé¢ï¼ˆindex.html + main.ts + stylesï¼‰
â””â”€â”€ public/icons/           # å›¾æ ‡èµ„æº
```

### 3.2 ä¸»æµé’±åŒ…å¯¹æ¯”

| ç‰¹æ€§ | MetaMask | Rabby | PanguPay (è§„åˆ’) |
|:-----|:--------:|:-----:|:---------------:|
| é“¾ç±»å‹ | EVM | EVM | UTXO (ç›˜å¤) |
| æ³¨å…¥å¯¹è±¡ | `window.ethereum` | `window.rabby` | `window.pangu` |
| å¤šé“¾æ”¯æŒ | âœ… | âœ… | âš ï¸ å•é“¾ + è·¨é“¾æ¡¥ |
| äº¤æ˜“æ¨¡æ‹Ÿ | âŒ | âœ… | âŒ |
| å³æ—¶ç¡®è®¤ | âŒ | âŒ | âœ… TXCer ç‰¹è‰² |

### 3.3 æŠ€æœ¯é€‰å‹å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|:-------|:-----|:-----|
| **UI æ¡†æ¶** | åŸç”Ÿ HTML+CSS+TS | ä¸ç°æœ‰é¡¹ç›®ä¸€è‡´ï¼Œå¤ç”¨æ–¹ä¾¿ |
| **æ„å»ºå·¥å…·** | Vite + @crxjs/vite-plugin | ç°ä»£ã€å¿«é€Ÿã€æ‰©å±•æ”¯æŒå¥½ |
| **é¡¹ç›®ç»“æ„** | ç‹¬ç«‹æ–°é¡¹ç›® | æ„å»ºç‹¬ç«‹ã€å‘å¸ƒåˆ†ç¦» |
| **ä»£ç å…±äº«** | æ‰‹åŠ¨å¤åˆ¶æ ¸å¿ƒæ¨¡å— | ç®€å•ç›´æ¥ï¼Œæœªæ¥å¯æŠ½åŒ… |

---

## 4. æ¶æ„è®¾è®¡

### 4.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµè§ˆå™¨ç¯å¢ƒ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Popup UI   â”‚â—„â”€â”€â–ºâ”‚  Background  â”‚â—„â”€â”€â–ºâ”‚  Content Script  â”‚   â”‚
â”‚  â”‚  (å¼¹çª—ç•Œé¢)   â”‚    â”‚ (Service Worker) â”‚    â”‚   (æ³¨å…¥ç½‘é¡µ)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                   â”‚                      â”‚            â”‚
â”‚         â”‚                   â”‚                      â–¼            â”‚
â”‚         â”‚                   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚         â”‚                   â”‚              â”‚  window.pangu â”‚     â”‚
â”‚         â”‚                   â”‚              â”‚  (ç½‘ç«™è°ƒç”¨)    â”‚     â”‚
â”‚         â”‚                   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â–¼                   â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                    Core æ ¸å¿ƒå±‚                          â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚
â”‚  â”‚  â”‚signature â”‚ â”‚   api    â”‚ â”‚keyEncryptâ”‚ â”‚ storage  â”‚   â”‚     â”‚
â”‚  â”‚  â”‚  ç­¾å    â”‚ â”‚ APIå®¢æˆ·ç«¯ â”‚ â”‚ å¯†é’¥åŠ å¯†  â”‚ â”‚ å­˜å‚¨    â”‚   â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚     â”‚
â”‚  â”‚  â”‚  types   â”‚                                           â”‚     â”‚
â”‚  â”‚  â”‚ ç±»å‹å®šä¹‰  â”‚                                           â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Gateway API    â”‚
                    â”‚  (åç«¯èŠ‚ç‚¹æ¥å£)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> å¤‡æ³¨ï¼š`txBuilder` ä¸ºè®¡åˆ’æ¥å…¥æ¨¡å—ï¼ˆæ¥è‡ªä¸»é’±åŒ…çš„äº¤æ˜“æ„é€ é€»è¾‘ï¼‰ï¼Œå½“å‰æ‰©å±•æ ¸å¿ƒä»¥ç­¾å/åŠ å¯†/API/å­˜å‚¨ä¸ºä¸»ã€‚

### 4.2 é€šä¿¡æµç¨‹

```mermaid
sequenceDiagram
    participant Web as ç¬¬ä¸‰æ–¹ç½‘ç«™
    participant CS as Content Script
    participant BG as Background
    participant Popup as Popup UI
    participant API as Gateway API

    Note over CS: å‘ç½‘é¡µæ³¨å…¥ window.pangu

    Web->>CS: pangu.connect()
    CS->>BG: è½¬å‘è¿æ¥è¯·æ±‚
    BG->>Popup: æ‰“å¼€æˆæƒå¼¹çª—
    Popup-->>BG: ç”¨æˆ·æˆæƒ
    BG-->>CS: è¿”å›è´¦æˆ·ä¿¡æ¯
    CS-->>Web: Promise resolve

    Web->>CS: pangu.sendTransaction()
    CS->>BG: è½¬å‘äº¤æ˜“è¯·æ±‚
    BG->>Popup: æ˜¾ç¤ºäº¤æ˜“ç¡®è®¤
    Popup->>BG: ç”¨æˆ·ç¡®è®¤ç­¾å
    BG->>API: æäº¤äº¤æ˜“
    API-->>BG: è¿”å› txId
    BG-->>CS: è¿”å›ç»“æœ
    CS-->>Web: Promise resolve
```

> å½“å‰å®ç°ï¼šBackground ä¸ä¼šä¸»åŠ¨æ‹‰èµ·å¼¹çª—ã€‚è‹¥æœªç™»å½•/æœªè§£é”ï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯ï¼Œç”¨æˆ·éœ€æ‰‹åŠ¨æ‰“å¼€æ’ä»¶å®Œæˆæˆæƒ/ç­¾åã€‚

---

## 5. åŠŸèƒ½æ¨¡å—è¯¦è§£

> è¯´æ˜ï¼šæœ¬èŠ‚ä¸ºåŠŸèƒ½ç›®æ ‡ä¸å¤ç”¨æ–¹å‘è¯´æ˜ï¼Œå®é™…æ¥å…¥ç¨‹åº¦ä»¥ `src/` ç°çŠ¶ä¸ºå‡†ã€‚

### 5.1 ç™»å½•ä¸æ³¨å†Œæ¨¡å—

```
åŠŸèƒ½ç‚¹ï¼š
â”œâ”€â”€ åˆ›å»ºæ–°è´¦æˆ·
â”‚   â”œâ”€â”€ ç”Ÿæˆ P-256 å¯†é’¥å¯¹
â”‚   â”œâ”€â”€ æ´¾ç”Ÿé’±åŒ…åœ°å€
â”‚   â””â”€â”€ è®¾ç½®ç™»å½•å¯†ç ï¼ˆPBKDF2 + AES åŠ å¯†ç§é’¥ï¼‰
â”œâ”€â”€ å¯¼å…¥è´¦æˆ·
â”‚   â”œâ”€â”€ ç§é’¥å¯¼å…¥ (Hex æ ¼å¼)
â”‚   â””â”€â”€ è®¾ç½®ç™»å½•å¯†ç 
â””â”€â”€ ç™»å½•è§£é”
    â”œâ”€â”€ å¯†ç éªŒè¯
    â””â”€â”€ è§£å¯†ç§é’¥åˆ°å†…å­˜
```

**å¤ç”¨ä»£ç **ï¼š
- `js/utils/signature.ts` - å¯†é’¥ç”Ÿæˆã€åœ°å€æ´¾ç”Ÿ
- `js/utils/keyEncryption.ts` - ç§é’¥åŠ å¯†å­˜å‚¨

### 5.2 é’±åŒ…ä¿¡æ¯æŸ¥çœ‹æ¨¡å—

```
åŠŸèƒ½ç‚¹ï¼š
â”œâ”€â”€ æ€»ä½™é¢å±•ç¤º
â”‚   â”œâ”€â”€ PGC ä½™é¢
â”‚   â”œâ”€â”€ BTC ä½™é¢
â”‚   â””â”€â”€ ETH ä½™é¢
â”œâ”€â”€ åœ°å€åˆ—è¡¨
â”‚   â”œâ”€â”€ ä¸»åœ°å€
â”‚   â””â”€â”€ å­åœ°å€ï¼ˆæŠ˜å æ˜¾ç¤ºï¼‰
â””â”€â”€ TXCer ä½™é¢ï¼ˆå³æ—¶åˆ°è´¦å‡­è¯ï¼‰
```

**å¤ç”¨ä»£ç **ï¼š
- `js/services/wallet.ts` - é’±åŒ…çŠ¶æ€ç®¡ç†
- `js/services/accountQuery.ts` - ä½™é¢æŸ¥è¯¢

### 5.3 è½¬è´¦äº¤æ˜“æ¨¡å—

```
åŠŸèƒ½ç‚¹ï¼š
â”œâ”€â”€ ç»„ç»‡å†…å¿«é€Ÿè½¬è´¦ï¼ˆUserNewTX / AssignNodeï¼‰
â”‚   â”œâ”€â”€ ç»„ç»‡å†…å³æ—¶ç¡®è®¤ï¼ˆTXCer ç­¾å‘ï¼‰
â”‚   â””â”€â”€ æ”¶æ¬¾æ–¹å¯ç”¨ TXCer æ”¯ä»˜ï¼ˆTXType=1ï¼‰
â”œâ”€â”€ è·¨é“¾äº¤æ˜“ (IsCrossChain=true)
â”‚   â”œâ”€â”€ BTC â†’ PGC
â”‚   â””â”€â”€ ETH â†’ PGC
â””â”€â”€ æ™®é€šè½¬è´¦ï¼ˆNoGuarGroup / ComNodeï¼‰
    â””â”€â”€ æ•£æˆ·èšåˆäº¤æ˜“ï¼ˆTXType=8ï¼‰
```

**å¤ç”¨ä»£ç **ï¼š
- `js/services/txBuilder.ts` - äº¤æ˜“æ„é€ 
- `js/services/transfer.ts` - è½¬è´¦æµç¨‹
- `js/utils/signature.ts` - äº¤æ˜“ç­¾å

### 5.4 æ‹…ä¿ç»„ç»‡æ¨¡å—

```
åŠŸèƒ½ç‚¹ï¼š
â”œâ”€â”€ æŸ¥çœ‹ç»„ç»‡åˆ—è¡¨
â”œâ”€â”€ åŠ å…¥ç»„ç»‡
â”‚   â”œâ”€â”€ é€‰æ‹©ç»„ç»‡
â”‚   â””â”€â”€ æ³¨å†Œåœ°å€
â””â”€â”€ é€€å‡ºç»„ç»‡
```

**å¤ç”¨ä»£ç **ï¼š
- `js/services/group.ts` - ç»„ç»‡ç®¡ç†

### 5.5 äº¤æ˜“å†å²æ¨¡å—

```
åŠŸèƒ½ç‚¹ï¼š
â”œâ”€â”€ äº¤æ˜“åˆ—è¡¨
â”‚   â”œâ”€â”€ å‘é€è®°å½•
â”‚   â”œâ”€â”€ æ¥æ”¶è®°å½•
â”‚   â””â”€â”€ çŠ¶æ€æ ‡è¯†ï¼ˆæˆåŠŸ/å¾…ç¡®è®¤/å¤±è´¥ï¼‰
â””â”€â”€ äº¤æ˜“è¯¦æƒ…
    â”œâ”€â”€ äº¤æ˜“å“ˆå¸Œ
    â”œâ”€â”€ æ—¶é—´æˆ³
    â””â”€â”€ é‡‘é¢/æ‰‹ç»­è´¹
```

**å¤ç”¨ä»£ç **ï¼š
- `js/services/txHistory.ts` - å†å²è®°å½•ç®¡ç†

---

## 6. ä»£ç å¤ç”¨è®¡åˆ’

### 6.1 éœ€è¦å¤åˆ¶çš„æ–‡ä»¶

ä» `TransferAreaInterface/js/` å¤åˆ¶åˆ° `PanguPayExtension/src/core/`ï¼š

| æºæ–‡ä»¶ | ç›®æ ‡ | ä¿®æ”¹ç¨‹åº¦ |
|:-------|:-----|:--------:|
| `utils/signature.ts` | `core/signature.ts` | æ— éœ€ä¿®æ”¹ |
| `services/txBuilder.ts` | `core/txBuilder.ts` | æ— éœ€ä¿®æ”¹ |
| `utils/keyEncryption.ts` | `core/keyEncryption.ts` | æ— éœ€ä¿®æ”¹ |
| `services/api.ts` | `core/api.ts` | å¾®è°ƒ CORS |
| `utils/bigIntJson.ts` | `core/bigIntJson.ts` | æ— éœ€ä¿®æ”¹ |
| `core/types.ts` | `core/types.ts` | æ— éœ€ä¿®æ”¹ |

### 6.2 éœ€è¦é€‚é…çš„æ–‡ä»¶

| æºæ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|:-------|:---------|
| `utils/storage.ts` | localStorage â†’ chrome.storage.local |
| `services/accountPolling.ts` | setInterval â†’ chrome.alarms |

### 6.3 éœ€è¦æ–°å¼€å‘çš„æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|:-----|:-----|
| `manifest.json` | æ‰©å±•é…ç½® |
| `background/index.ts` | Service Worker å…¥å£ |
| `content/index.ts` | Content Script å…¥å£ |
| `content/inject.ts` | æ³¨å…¥ window.pangu |
| `popup/index.html` | å¼¹çª—å…¥å£é¡µé¢ |
| `popup/main.ts` | å¼¹çª—å…¥å£è„šæœ¬ |
| `popup/pages/*` | å¼¹çª—é¡µé¢ |
| `popup/styles/main.css` | å¼¹çª—æ ·å¼ |

---

## 7. ç›®å½•ç»“æ„

```
PanguPayExtension/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ package.json                 # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.ts               # Vite æ„å»ºé…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScript é…ç½®
â”œâ”€â”€ manifest.json                # Chrome æ‰©å±•é…ç½®
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ icons/                   # æ‰©å±•å›¾æ ‡
â”‚       â”œâ”€â”€ icon16.svg
â”‚       â”œâ”€â”€ icon48.svg
â”‚       â””â”€â”€ icon128.svg
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ background/              # åå° Service Worker
â”‚   â”‚   â””â”€â”€ index.ts             # å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ content/                 # æ³¨å…¥è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ index.ts             # Content Script å…¥å£
â”‚   â”‚   â””â”€â”€ inject.ts            # æ³¨å…¥ window.pangu
â”‚   â”‚
â”‚   â”œâ”€â”€ popup/                   # å¼¹çª—ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ index.html           # å…¥å£ HTML
â”‚   â”‚   â”œâ”€â”€ main.ts              # å…¥å£ TS
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ main.css         # æ ·å¼
â”‚   â”‚   â””â”€â”€ pages/               # é¡µé¢
â”‚   â”‚       â”œâ”€â”€ welcome.ts       # æ¬¢è¿é¡µ
â”‚   â”‚       â”œâ”€â”€ unlock.ts        # è§£é”é¡µ
â”‚   â”‚       â”œâ”€â”€ create.ts        # åˆ›å»ºé¡µ
â”‚   â”‚       â”œâ”€â”€ import.ts        # å¯¼å…¥é¡µ
â”‚   â”‚       â”œâ”€â”€ home.ts          # é¦–é¡µï¼ˆä½™é¢ï¼‰
â”‚   â”‚       â”œâ”€â”€ send.ts          # å‘é€é¡µ
â”‚   â”‚       â”œâ”€â”€ receive.ts       # æ¥æ”¶é¡µ
â”‚   â”‚       â”œâ”€â”€ history.ts       # å†å²é¡µ
â”‚   â”‚       â”œâ”€â”€ organization.ts  # ç»„ç»‡é¡µ
â”‚   â”‚       â””â”€â”€ settings.ts      # è®¾ç½®é¡µ
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒé€»è¾‘ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ signature.ts         # ç­¾å
â”‚   â”‚   â”œâ”€â”€ keyEncryption.ts     # å¯†é’¥åŠ å¯†
â”‚   â”‚   â”œâ”€â”€ api.ts               # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ storage.ts           # å­˜å‚¨ï¼ˆé€‚é…ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ types.ts             # ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â””â”€â”€ sdk/                     # å¯¹å¤– SDKï¼ˆè§„åˆ’/å¯é€‰ï¼‰
â”‚       â””â”€â”€ index.ts             # window.pangu æ¥å£å®šä¹‰
â”‚
â””â”€â”€ dist/                        # æ„å»ºè¾“å‡ºï¼ˆåŠ è½½åˆ° Chromeï¼‰
```

---

## 8. å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ (3-4 å¤©)

- [ ] åˆå§‹åŒ–é¡¹ç›®ç»“æ„
- [ ] é…ç½® Vite + Chrome æ‰©å±•æ’ä»¶
- [ ] åˆ›å»º manifest.json
- [ ] å®ç°åŸºç¡€ Popup éª¨æ¶
- [ ] å¤åˆ¶æ ¸å¿ƒä»£ç æ¨¡å—

### Phase 2: è´¦æˆ·åŠŸèƒ½ (3-4 å¤©)

- [ ] åˆ›å»ºè´¦æˆ·ç•Œé¢
- [ ] å¯¼å…¥è´¦æˆ·ç•Œé¢
- [ ] å¯†ç è®¾ç½®ä¸éªŒè¯
- [ ] è§£é”ç•Œé¢
- [ ] chrome.storage é€‚é…

### Phase 3: é’±åŒ…å±•ç¤º (2-3 å¤©)

- [ ] é¦–é¡µä½™é¢å±•ç¤º
- [ ] å¤šå¸ç§æ˜¾ç¤º
- [ ] åœ°å€åˆ—è¡¨
- [ ] æ¥æ”¶é¡µé¢ï¼ˆäºŒç»´ç ï¼‰

### Phase 4: è½¬è´¦åŠŸèƒ½ (4-5 å¤©)

- [ ] å‘é€é¡µé¢ UI
- [ ] å¿«é€Ÿè½¬è´¦å®ç°
- [ ] è·¨é“¾äº¤æ˜“å®ç°
- [ ] æ™®é€šè½¬è´¦å®ç°
- [ ] äº¤æ˜“ç¡®è®¤å¼¹çª—

### Phase 5: æ‰©å±•åŠŸèƒ½ (2-3 å¤©)

- [ ] æ‹…ä¿ç»„ç»‡é¡µé¢
- [ ] äº¤æ˜“å†å²é¡µé¢
- [ ] è®¾ç½®é¡µé¢

### Phase 6: DApp è¿æ¥ (2-3 å¤©)

- [ ] Content Script æ³¨å…¥
- [ ] window.pangu API
- [ ] è¿æ¥æˆæƒæµç¨‹
- [ ] äº¤æ˜“ç­¾åæµç¨‹

### Phase 7: æµ‹è¯•å‘å¸ƒ (3-5 å¤©)

- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] UI ç¾åŒ–è°ƒæ•´
- [ ] Chrome Web Store æäº¤
- [ ] æ–‡æ¡£å®Œå–„

**æ€»è®¡ï¼š19-27 å¤©**

---

## 9. æŠ€æœ¯å®ç°ç»†èŠ‚

### 9.1 Manifest.json é…ç½®

```json
{
  "manifest_version": 3,
  "name": "PanguPay Wallet",
  "version": "1.0.0",
  "description": "ç›˜å¤ç³»ç»Ÿ UTXO é’±åŒ…æ‰©å±• - å®‰å…¨ã€å¿«é€Ÿã€ä¾¿æ·",
  
  "action": {
    "default_popup": "src/popup/index.html",
    "default_icon": {
      "16": "public/icons/icon16.svg",
      "48": "public/icons/icon48.svg",
      "128": "public/icons/icon128.svg"
    }
  },
  
  "background": {
    "service_worker": "src/background/index.ts",
    "type": "module"
  },
  
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["src/content/index.ts"],
      "run_at": "document_start"
    }
  ],
  
  "permissions": [
    "storage",
    "alarms"
  ],
  
  "host_permissions": [
    "http://47.243.174.71:*/*",
    "http://127.0.0.1:*/*",
    "http://localhost:*/*"
  ],
  
  "icons": {
    "16": "public/icons/icon16.svg",
    "48": "public/icons/icon48.svg",
    "128": "public/icons/icon128.svg"
  },

  "web_accessible_resources": [
    {
      "resources": ["src/content/inject.ts"],
      "matches": ["<all_urls>"]
    }
  ]
}
```

### 9.2 Storage é€‚é…ç¤ºä¾‹

```typescript
// ç”¨æ³•ç¤ºä¾‹ï¼ˆä»»æ„æ¨¡å—ä¸­ï¼‰
import { saveAccount, getActiveAccount } from '../core/storage';

await saveAccount(account);
const current = await getActiveAccount();
```

### 9.3 window.pangu API è®¾è®¡

```typescript
// src/sdk/index.ts - å¯¹å¤–æš´éœ²çš„ API

interface PanguWallet {
  // è¿æ¥é’±åŒ…
  connect(): Promise<{ address: string; accountId: string }>;
  
  // æ–­å¼€è¿æ¥
  disconnect(): Promise<void>;
  
  // è·å–å½“å‰è´¦æˆ·
  getAccount(): Promise<{
    address: string;
    accountId: string;
    balance: Record<number, number>;
    organization?: string | null;
  } | null>;
  
  // å‘é€äº¤æ˜“
  sendTransaction(params: {
    to: string;
    amount: number;
    coinType?: number; // 0=PGC, 1=BTC, 2=ETH
    isCrossChain?: boolean;
  }): Promise<{ txId: string; status: string }>;
  
  // ç›‘å¬è´¦æˆ·å˜åŒ–
  on(event: 'accountChanged' | 'disconnect', callback: Function): void;

  // è§£é™¤ç›‘å¬
  off(event: 'accountChanged' | 'disconnect', callback: Function): void;
  
  // æ£€æŸ¥æ˜¯å¦å·²è¿æ¥
  isConnected(): Promise<boolean>;
}

// ç½‘ç«™ä½¿ç”¨ç¤ºä¾‹
// const result = await window.pangu.connect();
// console.log('åœ°å€:', result.address);
```

---

## 10. ç½‘ç«™å¯¹æ¥æŒ‡å—

### 10.1 æ£€æµ‹æ‰©å±•

```javascript
function isPanguInstalled() {
  return typeof window.pangu !== 'undefined';
}

if (!isPanguInstalled()) {
  alert('è¯·å…ˆå®‰è£… PanguPay é’±åŒ…æ‰©å±•');
  window.open('https://chrome.google.com/webstore/detail/pangupay/xxx');
}
```

### 10.2 è¿æ¥é’±åŒ…

```javascript
async function connectWallet() {
  try {
    const { address, accountId } = await window.pangu.connect();
    console.log('å·²è¿æ¥:', address, accountId);
    // æ›´æ–° UI æ˜¾ç¤ºå·²è¿æ¥çŠ¶æ€
  } catch (error) {
    console.error('ç”¨æˆ·æ‹’ç»è¿æ¥');
  }
}
```

### 10.3 å‘é€äº¤æ˜“

```javascript
async function sendPayment(toAddress, amount) {
  try {
    const result = await window.pangu.sendTransaction({
      to: toAddress,
      amount: amount,
      coinType: 0, // PGC
    });
    console.log('äº¤æ˜“æˆåŠŸ:', result.txId);
  } catch (error) {
    console.error('äº¤æ˜“å¤±è´¥:', error.message);
  }
}
```

### 10.4 ç›‘å¬äº‹ä»¶

```javascript
// ç›‘å¬è´¦æˆ·åˆ‡æ¢
window.pangu.on('accountChanged', (newAddress) => {
  console.log('è´¦æˆ·å·²åˆ‡æ¢:', newAddress);
  // åˆ·æ–°é¡µé¢æ•°æ®
});

// ç›‘å¬æ–­å¼€è¿æ¥
window.pangu.on('disconnect', () => {
  console.log('é’±åŒ…å·²æ–­å¼€');
  // æ¸…ç†çŠ¶æ€
});
```

---

## ğŸ“Œ é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [TransferAreaInterface æ¶æ„](../TransferAreaInterface/docs/02-architecture.md)
- [UTXO-Area å¯¹æ¥æŒ‡å—](../UTXO-Area/docs/04-api-integration.md)
- [Chrome æ‰©å±•å¼€å‘æ–‡æ¡£](https://developer.chrome.com/docs/extensions/mv3/)

### B. å‚è€ƒé¡¹ç›®

- [MetaMask Extension](https://github.com/MetaMask/metamask-extension)
- [Rabby Wallet](https://github.com/RabbyHub/Rabby)

### C. è®¾è®¡èµ„æº

- å›¾æ ‡è§„æ ¼ï¼š16x16, 48x48, 128x128 SVG
- Popup å°ºå¯¸ï¼šå®½ 360pxï¼Œé«˜åº¦è‡ªé€‚åº”ï¼ˆå»ºè®® 500-600pxï¼‰

---

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0  
> **æœ€åæ›´æ–°**ï¼š2026-01-21  
> **ç»´æŠ¤è€…**ï¼šPanguPay Team
